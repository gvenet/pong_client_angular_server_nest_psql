<!-- src/app/components/admin/admin.component.html -->
<div class="admin-container">
  <div class="admin-header">
    <h1>ğŸ›¡ï¸ Administration</h1>
    <button class="btn-back" (click)="backToLobby()">â† Retour au lobby</button>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="selectedTab === 'users'"
      (click)="switchTab('users')">
      ğŸ‘¥ Utilisateurs
    </button>
    <button
      class="tab"
      [class.active]="selectedTab === 'chat'"
      (click)="switchTab('chat')">
      ğŸ’¬ Chat
    </button>
  </div>

  <div class="admin-content">
    <!-- Users Section -->
    <div *ngIf="selectedTab === 'users'">
      <div class="loading" *ngIf="loading">
        <p>Chargement des utilisateurs...</p>
      </div>

      <div class="error" *ngIf="error">
        <p>{{ error }}</p>
      </div>

      <div class="users-section" *ngIf="!loading && !error">
        <div class="section-header">
          <h2>Gestion des utilisateurs</h2>
          <p class="user-count">{{ users.length }} utilisateur(s)</p>
        </div>

      <div class="users-table">
        <table>
          <thead>
            <tr>
              <th>Utilisateur</th>
              <th>Email</th>
              <th>RÃ´le</th>
              <th>ELO</th>
              <th>V/D</th>
              <th>Win Rate</th>
              <th>Inscription</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users" [class.current-user]="user.id === currentUser?.id">
              <td class="username">
                <strong>{{ user.username }}</strong>
                <span *ngIf="user.id === currentUser?.id" class="you-badge">Vous</span>
              </td>
              <td>{{ user.email }}</td>
              <td>
                <span class="role-badge" [ngClass]="getRoleClass(user.role)">
                  {{ user.role }}
                </span>
              </td>
              <td class="elo">{{ user.elo }}</td>
              <td class="stats">{{ user.wins }} / {{ user.losses }}</td>
              <td class="winrate">{{ getWinRate(user) }}%</td>
              <td class="date">{{ formatDate(user.createdAt) }}</td>
              <td class="actions">
                <button
                  class="btn-role"
                  (click)="toggleRole(user)"
                  [disabled]="user.id === currentUser?.id"
                  [title]="user.id === currentUser?.id ? 'Vous ne pouvez pas modifier votre propre rÃ´le' : 'Changer le rÃ´le'">
                  {{ user.role === 'admin' ? 'ğŸ‘¤' : 'ğŸ›¡ï¸' }}
                </button>
                <button
                  class="btn-delete"
                  (click)="deleteUser(user)"
                  [disabled]="user.id === currentUser?.id"
                  [title]="user.id === currentUser?.id ? 'Vous ne pouvez pas vous supprimer' : 'Supprimer l\'utilisateur'">
                  ğŸ—‘ï¸
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="empty-state" *ngIf="users.length === 0">
          <p>Aucun utilisateur trouvÃ©</p>
        </div>
      </div>
    </div>
    </div>

    <!-- Chat Section -->
    <div *ngIf="selectedTab === 'chat'">
      <div class="chat-section">
        <!-- Stats -->
        <div class="chat-stats" *ngIf="chatStats">
          <div class="stat-card">
            <div class="stat-value">{{ chatStats.totalMessages }}</div>
            <div class="stat-label">Total</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ chatStats.globalMessages }}</div>
            <div class="stat-label">Globaux</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ chatStats.gameMessages }}</div>
            <div class="stat-label">Parties</div>
          </div>
        </div>

        <!-- Filters -->
        <div class="chat-filters">
          <button
            class="filter-btn"
            [class.active]="chatFilter === 'all'"
            (click)="setChatFilter('all')">
            Tous
          </button>
          <button
            class="filter-btn"
            [class.active]="chatFilter === 'global'"
            (click)="setChatFilter('global')">
            Globaux
          </button>
          <button
            class="filter-btn"
            [class.active]="chatFilter === 'game'"
            (click)="setChatFilter('game')">
            Parties
          </button>
        </div>

        <div class="loading" *ngIf="chatLoading">
          <p>Chargement des messages...</p>
        </div>

        <div class="error" *ngIf="chatError">
          <p>{{ chatError }}</p>
        </div>

        <!-- Messages Table -->
        <div class="messages-table" *ngIf="!chatLoading && !chatError">
          <table>
            <thead>
              <tr>
                <th>Type</th>
                <th>Utilisateur</th>
                <th>Message</th>
                <th>Partie</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let message of messages">
                <td>
                  <span class="type-badge" [ngClass]="getMessageTypeClass(message)">
                    {{ getMessageTypeLabel(message) }}
                  </span>
                </td>
                <td class="username">{{ message.user.username }}</td>
                <td class="message-content">{{ message.message }}</td>
                <td class="game-id">{{ message.game_id || '-' }}</td>
                <td class="date">{{ formatDateTime(message.sentAt) }}</td>
                <td class="actions">
                  <button
                    class="btn-delete"
                    (click)="deleteMessage(message)"
                    title="Supprimer le message">
                    ğŸ—‘ï¸
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="empty-state" *ngIf="messages.length === 0">
            <p>Aucun message trouvÃ©</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
